<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ржкрзНрж░рзЛржбрж╛ржХрж╢ржи рж▓рж┐рж╕рзНржЯ</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<style>
    /* ржХрж╛рж╕рзНржЯржо рж╕рзНржЯрж╛ржЗрж▓: ржХрж╛ржЬрзЗрж░ ржЗржиржкрзБржЯржЧрзБрж▓рж┐рж░ ржЬржирзНржп */
    /* ЁЯТб ржлрж┐ржХрзНрж╕ржб: ржХрж╛ржЬрзЗрж░ ржПржирзНржЯрзНрж░рж┐ ржЧрзНрж░рж┐ржбржХрзЗ ржЫрзЛржЯ рж╕рзНржХрзНрж░рж┐ржирзЗрж░ ржЬржирзНржп ржЕржкржЯрж┐ржорж╛ржЗржЬ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ */
    .work-entry {
        display: grid;
        grid-template-columns: repeat(2, 1fr); /* ржЫрзЛржЯ рж╕рзНржХрзНрж░рж┐ржирзЗ 2 ржХрж▓рж╛ржо */
        gap: 8px;
        align-items: center;
        margin-bottom: 8px;
        padding-bottom: 8px;
        border-bottom: 1px solid #eee;
    }
    /* ржмрзЬ рж╕рзНржХрзНрж░рж┐ржирзЗрж░ ржЬржирзНржп ржХрж╛рж╕рзНржЯржо ржЧрзНрж░рж┐ржб рж▓рзЗржЖржЙржЯ */
    @media (min-width: 640px) {
        .work-entry {
            grid-template-columns: 2fr 1fr 1fr 1fr 20px; /* 5 ржХрж▓рж╛ржо: ржмрж┐ржмрж░ржг, рж╕рзНржЯрж┐ржЪ, ржмрзНржпрж╛рж╕, ржорзЛржЯ, ржбрж┐рж▓рж┐ржЯ */
        }
    }
    
    /* ЁЯТб ржирждрзБржи рж╕рзНржЯрж╛ржЗрж▓: ржХрж╛рж░рзНржб рж╕рзНржЯрж╛ржЗрж▓ рж▓рж┐рж╕рзНржЯ */
    .production-card {
        cursor: pointer; 
        transition: transform 0.1s;
    }
    .production-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    /* ржоржбрж╛рж▓рзЗрж░ ржнрзЗрждрж░рзЗрж░ ржЗржиржкрзБржЯржЧрзБрж▓рж┐рж░ ржЬржирзНржп ржЫрзЛржЯ ржлржирзНржЯ */
    .modal-input {
        padding: 6px;
        font-size: 0.875rem; /* text-sm */
    }

    /* ржоржбрж╛рж▓ ржХрж╛ржЬрзЗрж░ ржЗржиржкрзБржЯржЧрзБрж▓рж┐рж░ ржЬржирзНржп рж░рзЗрж╕ржкржирж╕рж┐ржн ржлрж┐ржХрзНрж╕ */
    .work-input-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 8px;
    }
    @media (min-width: 640px) {
        .work-input-grid {
            grid-template-columns: 1fr 1fr;
        }
    }
</style>
</head>
<body class="bg-gray-100 min-h-screen p-6 mt-12">
<div id="header-placeholder"></div>
<div id="loader" class="fixed inset-0 bg-gray-100 flex items-center justify-center z-50">
<div class="animate-spin rounded-full h-16 w-16 border-t-4 border-indigo-600"></div>
</div>

<div class="max-w-6xl mx-auto hidden" id="mainContent">

<div class="bg-white shadow-lg rounded-lg p-4 mb-6">
<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-7 gap-4 justify-items-center">

<div class="w-full max-w-[140px]">
<label class="block text-gray-600 mb-1 text-sm">ржХрж░рзНржоржЪрж╛рж░рзА</label>
<select id="filterWorker" class="border rounded p-2 w-full text-sm">
<option value="">рж╕ржм</option>
</select>
</div>

<div class="w-full max-w-[140px]">
<label class="block text-gray-600 mb-1 text-sm">ржорзЗрж╢рж┐ржи</label>
<select id="filterMachine" class="border rounded p-2 w-full text-sm">
<option value="">рж╕ржм</option>
</select>
</div>

<div class="w-full max-w-[140px]">
<label class="block text-gray-600 mb-1 text-sm">ржорж╛рж╕</label>
<select id="filterMonth" class="border rounded p-2 w-full text-sm"></select>
</div>

<div class="w-full max-w-[140px]">
<label class="block text-gray-600 mb-1 text-sm">ржмржЫрж░</label>
<select id="filterYear" class="border rounded p-2 w-full text-sm"></select>
</div>

<div class="w-full max-w-[140px]">
<label class="block text-gray-600 mb-1 text-sm">ржерзЗржХрзЗ</label>
<input type="date" id="filterFrom" class="border rounded p-2 w-full text-sm">
</div>

<div class="w-full max-w-[140px]">
<label class="block text-gray-600 mb-1 text-sm">ржкрж░рзНржпржирзНржд</label>
<input type="date" id="filterTo" class="border rounded p-2 w-full text-sm">
</div>

<div class="w-full max-w-[140px] flex gap-2 justify-center items-end">
    <button id="clearFilter" class="px-3 py-2 bg-indigo-500 rounded hover:bg-gray-400 text-white text-sm">
       ЁЯФБ рж░рж┐рж╕рзЗржЯ
    </button>
</div>
<div class="w-full max-w-[140px] flex gap-2 justify-center items-end">
    <a id="addStitchButton" href="add-stitch.html" class="px-3 py-2 bg-indigo-500 rounded hover:bg-gray-400 text-white text-sm text-center hidden">
        тЮХ ржпрзБржХрзНржд ржХрж░рзБржи
    </a>
</div>

</div>
</div>

<div id="summaryCards" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3 mb-6">
<div id="totalProductionCard" class="bg-white shadow rounded p-3 text-center">
<h3 class="text-gray-500 text-xs">ржорзЛржЯ ржкрзНрж░рзЛржбрж╛ржХрж╢ржи</h3>
<p id="totalProductionValue" class="text-xl font-bold text-indigo-700">0</p>
</div>
<div id="averageProductionCard" class="bg-white shadow rounded p-3 text-center">
<h3 class="text-gray-500 text-xs">ржЧржбрж╝ ржкрзНрж░рзЛржбрж╛ржХрж╢ржи</h3>
<p id="averageProductionValue" class="text-xl font-bold text-green-600">0</p>
</div>

<div id="workdayProductionCard" class="bg-white shadow rounded p-3 text-center">
<h3 class="text-gray-500 text-xs">ржорзЛржЯ ржХрж╛ржЬрзЗрж░ ржжрж┐ржи</h3>
<p id="workdayProductionValue" class="text-xl font-bold text-indigo-700">0</p>
</div>
<div id="targetProductionCard" class="bg-white shadow rounded p-3 text-center">
<h3 class="text-gray-500 text-xs">ржЯрж╛рж░рзНржЧрзЗржЯ ржкрзНрж░рзЛржбрж╛ржХрж╢ржи</h3>
<p id="targetProductionValue" class="text-xl font-bold text-green-600">0</p>
</div>

<div id="determinedSalaryCard" class="bg-white shadow rounded p-3 text-center">
    <h3 class="text-gray-500 text-xs">ржирж┐рж░рзНржзрж╛рж░рж┐ржд ржмрзЗрждржи (ржорзЛржЯ)</h3>
    <p id="determinedSalaryValue" class="text-xl font-bold text-red-600">0</p>
</div>
<div id="earnedSalaryCard" class="bg-white shadow rounded p-3 text-center">
    <h3 class="text-gray-500 text-xs">ржкрзНрж░рж╛ржкрзНржп ржмрзЗрждржи (ржорзЛржЯ)</h3>
    <p id="earnedSalaryValue" class="text-xl font-bold text-blue-600">0</p>
</div>
</div>

<div class="bg-white shadow-lg rounded-lg p-6 text-center">

<h2 class="text-xl font-bold text-indigo-700 mb-4 text-center" id="tableTitle">ЁЯУЛ ржкрзНрж░рзЛржбрж╛ржХрж╢ржи рж▓рж┐рж╕рзНржЯ</h2>

<div id="productionList" class="space-y-3">
    </div>

</div>

<div id="modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-2xl overflow-y-auto max-h-[90vh]">
        <h3 class="text-xl font-bold mb-4 text-center" id="modalTitle">ржкрзНрж░рзЛржбрж╛ржХрж╢ржи ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд</h3>
        
        <form id="productionForm" class="space-y-4">
            <input type="hidden" id="modalProductionId">

            <div class="grid grid-cols-2 sm:grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-600 text-sm">рждрж╛рж░рж┐ржЦ</label>
                    <input type="date" id="modalDate" class="border rounded p-2 w-full modal-input" disabled>
                </div>
                <div>
                    <label class="block text-gray-600 text-sm">ржХрж░рзНржоржЪрж╛рж░рзА</label>
                    <select id="modalWorker" class="border rounded p-2 w-full modal-input" disabled></select>
                </div>
                <div>
                    <label class="block text-gray-600 text-sm">ржорзЗрж╢рж┐ржи</label>
                    <input type="text" id="modalMachine" class="border rounded p-2 w-full modal-input" disabled>
                </div>
                <div>
                    <label class="block text-gray-600 text-sm">ржорзЛржЯ рж╕рзНржЯрж┐ржЪ</label>
                    <input type="text" id="modalGrandTotal" class="border rounded p-2 w-full modal-input bg-gray-100" disabled>
                </div>
            </div>

            <hr>
            <h4 class="font-bold text-lg mb-2 text-center">ржХрж╛ржЬрзЗрж░ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд:</h4>
            
            <div class="grid gap-2 text-sm font-semibold text-gray-700 border-b-2 border-gray-300 pb-1 hidden sm:grid sm:grid-cols-[2fr_1fr_1fr_1fr_20px]">
                <span class="coll-span-1 text-left">ржмрж┐ржмрж░ржг/ржирж╛ржо</span>
                <span class="col-span-1 text-right">рж╕рзНржЯрж┐ржЪ (Stitch)</span>
                <span class="col-span-1 text-right">ржмрзНржпрж╛рж╕ (Quantity)</span>
                <span class="col-span-1 text-right">ржорзЛржЯ (Total)</span>
                <span></span>
            </div>

            <div id="modalWorksContainer" class="space-y-4">
                </div>

            <div id="adminControls" class="mt-6 flex justify-between">
                <button type="button" onclick="closeModal()" class="px-4 py-2 bg-gray-500 text-white rounded">ржмржирзНржз ржХрж░рзБржи</button>
                
                <div id="editDeleteButtons" class="space-x-4 hidden">
                    <button type="button" id="editButton" class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700" onclick="enableEditMode()">ржПржбрж┐ржЯ ржХрж░рзБржи</button>
                    <button type="submit" id="updateButton" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 hidden">ржЖржкржбрзЗржЯ</button>
                    <button type="button" id="deleteButton" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 hidden" onclick="deleteProduction()">ржбрж┐рж▓рж┐ржЯ</button>
                </div>
            </div>
        </form>

    </div>
</div>

</div>

<div id="footer-placeholder"></div>
<script src="include-loader.js"></script>
<script type="module">
// ---------------------------------------------------------------------------------------------------------
// ЁЯТб ржирзЛржЯ: рж╢рзБржзрзБржорж╛рждрзНрж░ ржжрзБржЯрж┐ ржлрж╛ржВрж╢ржи (renderProductions ржПржмржВ renderWorksContainer) ржЖржкржбрзЗржЯ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред
// ---------------------------------------------------------------------------------------------------------

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, getDocs, query, where, orderBy, doc, getDoc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// ЁЯФ╣ Firebase Config (ржЖржкржирж╛рж░ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи)
const firebaseConfig = {
    apiKey: "AIzaSyCdVxsSPUirznH-67MoHln3kdyPS1SMB94",
    authDomain: "asembroidery-5cd5e.firebaseapp.com",
    projectId: "asembroidery-5cd5e",
    storageBucket: "asembroidery-5cd5e.appspot.com",
    messagingSenderId: "592758047307",
    appId: "1:592758047307:web:d4f7d69bcd9f0398ac83ce"
};

// ЁЯФ╣ Firebase Initialization
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ЁЯФ╣ DOM Elements (ржПржХржЗ)
const productionList = document.getElementById("productionList");
const filterFrom = document.getElementById("filterFrom");
const filterTo = document.getElementById("filterTo");
const filterMachine = document.getElementById("filterMachine");
const filterWorker = document.getElementById("filterWorker");
const filterMonth = document.getElementById("filterMonth");
const filterYear = document.getElementById("filterYear");
const clearFilter = document.getElementById("clearFilter");
const tableTitle = document.getElementById("tableTitle");
const loader = document.getElementById("loader");
const mainContent = document.getElementById("mainContent");
const addStitchButton = document.getElementById("addStitchButton");
const determinedSalaryValue = document.getElementById("determinedSalaryValue");
const earnedSalaryValue = document.getElementById("earnedSalaryValue");
const modalWorksContainer = document.getElementById("modalWorksContainer");
const productionForm = document.getElementById("productionForm");
const editDeleteButtons = document.getElementById("editDeleteButtons");

const monthNames = ["ржЬрж╛ржирзБржпрж╝рж╛рж░рж┐", "ржлрзЗржмрзНрж░рзБржпрж╝рж╛рж░рж┐", "ржорж╛рж░рзНржЪ", "ржПржкрзНрж░рж┐рж▓", "ржорзЗ", "ржЬрзБржи", "ржЬрзБрж▓рж╛ржЗ", "ржЖржЧрж╕рзНржЯ", "рж╕рзЗржкрзНржЯрзЗржорзНржмрж░", "ржЕржХрзНржЯрзЛржмрж░", "ржиржнрзЗржорзНржмрж░", "ржбрж┐рж╕рзЗржорзНржмрж░"];

let allProductions = [];
let allWorkers = [];
let currentUserRole = ""; 

// ЁЯОп ржХржирж╕рзНржЯрзНржпрж╛ржирзНржЯ (ржПржХржЗ)
const WORKER_CATEGORY_ID = "6TeDHhrINuMH5SxU6dAr"; 
const TARGET_FIELD_NAME = "productionTarget";
const MONTHLY_TOTAL_DAYS = 25; 

// -----------------------------------------------------------------------
// ЁЯОп рж░тАНрзНржпрж╛ржЩрзНржХ, рж╕рзНржпрж╛рж▓рж╛рж░рж┐ ржЧржгржирж╛ ржлрж╛ржВрж╢ржи (ржкрзВрж░рзНржмрзЗрж░ ржорждрзЛржЗ)
// -----------------------------------------------------------------------
function calculateCumulativeRank(cumulativeTotal, dailyTarget) {
    if (dailyTarget === 0 || dailyTarget === null || isNaN(dailyTarget)) return '-'; 
    const monthlyTarget = dailyTarget * MONTHLY_TOTAL_DAYS;
    const rankStep = monthlyTarget / 5; 

    if (rankStep === 0) return '-'; 
    const comparisonValue = cumulativeTotal;

    if (comparisonValue >= rankStep * 4) return "ржЕржкрж╛рж░рзЗржЯрж░"; 
    else if (comparisonValue >= rankStep * 3) return "рж╕рж╣ржХрж╛рж░рзА"; 
    else if (comparisonValue >= rankStep * 2) return "рж╣рзЗрж▓ржкрж╛рж░"; 
    else if (comparisonValue >= rankStep * 1) return "рж╕ржлрж▓"; 
    else return "ржмрж┐ржлрж▓"; 
}

function calculateDailySalary(monthlySalary, month, year) {
    if (monthlySalary === 0 || isNaN(monthlySalary)) return 0;
    const daysInMonth = new Date(year, month + 1, 0).getDate(); 
    return monthlySalary / daysInMonth;
}

function calculateEarnedSalary(cumulativeAvg, dailyTarget, totalWorkingDays, determinedDailySalary) {
    if (dailyTarget === 0 || determinedDailySalary === 0 || totalWorkingDays === 0) return 0;
    const performanceRatio = cumulativeAvg / dailyTarget;
    const earnedDailySalary = determinedDailySalary * performanceRatio;
    return earnedDailySalary * totalWorkingDays;
}
// -----------------------------------------------------------------------

// ЁЯФ╣ Load Workers Dropdown (ржкрзВрж░рзНржмрзЗрж░ ржорждрзЛржЗ)
async function loadWorkers() {
    filterWorker.innerHTML = `<option value="">рж╕ржм</option>`;
    allWorkers = [];
    try {
        const q = query(collection(db, "people"), where("category_key", "==", WORKER_CATEGORY_ID));
        const snapshot = await getDocs(q);
        
        snapshot.forEach(docSnap => {
            const user = docSnap.data();
            user.id = docSnap.id;
            
            let targetValue = user[TARGET_FIELD_NAME];
            if (targetValue === undefined || targetValue === null) targetValue = 0;
            else targetValue = parseFloat(targetValue);
            user.productionTarget = isNaN(targetValue) ? 0 : targetValue; 
            
            let salaryValue = user.fixedSalary !== undefined ? parseFloat(user.fixedSalary) : 0;
            user.fixedSalary = isNaN(salaryValue) ? 0 : salaryValue;
            
            allWorkers.push(user); 
            const opt = document.createElement("option");
            opt.value = docSnap.id;
            opt.textContent = user.name;
            filterWorker.appendChild(opt);
        });
    } catch (error) {
        console.error("ржХрж░рзНржорзА рж▓рзЛржб ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛ рж╣ржпрж╝рзЗржЫрзЗ:", error);
    }
}

// ЁЯФ╣ Load Month/Year Dropdowns (ржкрзВрж░рзНржмрзЗрж░ ржорждрзЛржЗ)
function loadMonthYearFilters() {
    const now = new Date();
    filterMonth.innerHTML = "";
    monthNames.forEach((name, i) => {
        const opt = document.createElement("option");
        opt.value = i;
        opt.text = name;
        filterMonth.appendChild(opt);
    });
    filterMonth.value = now.getMonth();
    filterYear.innerHTML = "";
    for (let y = now.getFullYear(); y >= now.getFullYear() - 3; y--) {
        const opt = document.createElement("option");
        opt.value = y;
        opt.text = y;
        filterYear.appendChild(opt);
    }
    filterYear.value = now.getFullYear();
}

// ЁЯФ╣ Populate Machines Dropdown (ржкрзВрж░рзНржмрзЗрж░ ржорждрзЛржЗ)
function populateMachines(productions) {
    const machines = [...new Set(productions.map(p => p.machine))];
    filterMachine.innerHTML = `<option value="">рж╕ржм</option>`;
    machines.forEach(m => {
        const opt = document.createElement("option");
        opt.value = m;
        opt.textContent = m;
        filterMachine.appendChild(opt);
    });
}

// ЁЯФ╣ Fetch Productions from Firestore (ржкрзВрж░рзНржмрзЗрж░ ржорждрзЛржЗ)
async function fetchProductions() {
    loader.style.display = "flex";
    try {
        const q = query(collection(db, "productions"), orderBy("date", "desc"));
        const snapshot = await getDocs(q);
        allProductions = [];
        snapshot.forEach(docSnap => {
            let p = docSnap.data();
            p.id = docSnap.id;
            allProductions.push(p);
        });
        populateMachines(allProductions);
        renderProductions();
    } catch (err) {
        console.error("ржбрзЗржЯрж╛ рж▓рзЛржб ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛ рж╣ржпрж╝рзЗржЫрзЗ: ", err);
        productionList.innerHTML = `<div class="text-center py-4 text-red-500">ржбрзЗржЯрж╛ рж▓рзЛржб ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛ рж╣ржпрж╝рзЗржЫрзЗред</div>`;
    } 
}

// ЁЯФ╣ ЁЯТб ржЖржкржбрзЗржЯ ржХрж░рж╛ Render Productions (ржХрж╛рж░рзНржб рж▓рзЗржЖржЙржЯ ржлрж┐ржХрзНрж╕)
function renderProductions() {
    productionList.innerHTML = "";
    const monthFilter = filterMonth.value !== "" ? parseInt(filterMonth.value) : null;
    const yearFilter = filterYear.value !== "" ? parseInt(filterYear.value) : null;
    const startDate = filterFrom.value ? new Date(filterFrom.value + "T00:00:00") : null;
    const endDate = filterTo.value ? new Date(filterTo.value + "T23:59:59") : null;
    const machineFilter = filterMachine.value;
    const workerFilter = filterWorker.value;

    const filtered = allProductions
        .filter(p => {
            const dateObj = new Date(p.date);
            if (monthFilter !== null && dateObj.getMonth() !== monthFilter) return false;
            if (yearFilter !== null && dateObj.getFullYear() !== yearFilter) return false;
            if (startDate && dateObj < startDate) return false;
            if (endDate && dateObj > endDate) return false;
            if (machineFilter && p.machine !== machineFilter) return false;
            if (workerFilter && p.workerId !== workerFilter) return false;
            return true;
        });

    const monthName = monthFilter !== null ? monthNames[monthFilter] : "рж╕ржм ржорж╛рж╕";
    tableTitle.textContent = `ЁЯУЛ ${monthName} ┬╖ ржкрзНрж░рзЛржбрж╛ржХрж╢ржи`;
    
    const workerNameMap = allWorkers.reduce((map, worker) => {
        map[worker.id] = worker.name;
        map[`target-${worker.id}`] = worker.productionTarget || 0; 
        map[`salary-${worker.id}`] = worker.fixedSalary || 0;
        return map;
    }, {});


    const groupedData = filtered.reduce((acc, p) => {
        const dateKey = new Date(p.date).toISOString().split('T')[0];
        const workerKey = p.workerId;
        const uniqueKey = `${workerKey}-${dateKey}`;

        if (!acc[uniqueKey]) {
            acc[uniqueKey] = {
                ...p,
                date: dateKey,
                grandTotal: parseFloat(p.grandTotal),
                works: [...p.works],
                id: p.id,
                workerName: workerNameMap[p.workerId] || "ржЕржЬрж╛ржирж╛ ржХрж░рзНржорзА",
                dailyTarget: workerNameMap[`target-${p.workerId}`] || 0,
                monthlySalary: workerNameMap[`salary-${p.workerId}`] || 0
            };
        } else {
            acc[uniqueKey].grandTotal += parseFloat(p.grandTotal);
            acc[uniqueKey].works.push(...p.works);
        }
        return acc;
    }, {});

    const groupedArray = Object.values(groupedData);

    // ржбрж┐ржлрж▓рзНржЯ ржХрж╛рж░рзНржб ржорж╛ржи рж░рж┐рж╕рзЗржЯ (ржкрзВрж░рзНржмрзЗрж░ ржорждрзЛржЗ)
    document.getElementById("totalProductionValue").textContent = "0";
    document.getElementById("averageProductionValue").textContent = "0";
    document.getElementById("workdayProductionValue").textContent = "0";
    document.getElementById("targetProductionValue").textContent = "0"; 
    determinedSalaryValue.textContent = "0"; 
    earnedSalaryValue.textContent = "0";

    if (groupedArray.length === 0) {
        productionList.innerHTML = `<div class="text-center py-4">ржХрзЛржирзЛ ржбрзЗржЯрж╛ ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝ржирж┐ред</div>`;
        return;
    }

    let cumulativeTotals = {};
    let cumulativeCounts = {}; 
    let prevGrandTotals = {};
    
    const sortedByDate = [...groupedArray].sort((a, b) => new Date(a.date) - new Date(b.date));

    sortedByDate.forEach(p => {
        const wid = p.workerId;
        const grandTotal = p.grandTotal;

        if (!cumulativeTotals[wid]) cumulativeTotals[wid] = 0;
        if (!cumulativeCounts[wid]) cumulativeCounts[wid] = 0;
        
        cumulativeTotals[wid] += grandTotal;
        cumulativeCounts[wid]++;
        
        const dailyAvg = cumulativeTotals[wid] / cumulativeCounts[wid];

        p.cumulativeTotal = cumulativeTotals[wid]; 
        p.cumulativeAvg = dailyAvg;
        
        let totalColorClass = "";
        if (prevGrandTotals[wid] !== undefined) {
            if (grandTotal > prevGrandTotals[wid]) totalColorClass = "text-green-600 font-bold";
            else if (grandTotal < prevGrandTotals[wid]) totalColorClass = "text-red-600 font-bold";
        }
        prevGrandTotals[wid] = grandTotal;

        p.totalColorClass = totalColorClass;
        p.totalRank = calculateCumulativeRank(p.cumulativeTotal, p.dailyTarget);
    });

    const sortedForDisplay = sortedByDate.sort((a, b) => new Date(b.date) - new Date(a.date));

    // ЁЯТб ржХрж╛рж░рзНржб ржЖржХрж╛рж░рзЗ ржбрзЗржЯрж╛ рж░рзЗржирзНржбрж╛рж░ ржХрж░рж╛ (ржЖржкржирж╛рж░ рж╕рж░рзНржмрж╢рзЗрж╖ рж▓рзЗржЖржЙржЯ)
    sortedForDisplay.forEach(p => {
        const card = document.createElement("div");
        card.className = "production-card bg-white shadow rounded-lg p-4 border border-gray-200";
        card.onclick = () => viewProduction(p.id); 

        const date = new Date(p.date);
        // ЁЯТб рждрж╛рж░рж┐ржЦрзЗрж░ ржлрж░ржорзНржпрж╛ржЯ: рж╢рзБржзрзБ ржжрж┐ржи ржУ ржорж╛рж╕
        const formattedDate = date.toLocaleDateString('bn-BD', { day: 'numeric', month: 'short' }); 
        
        card.innerHTML = `
            <div class="flex justify-between items-center mb-2 border-b pb-2">
                <span class="text-sm font-semibold text-gray-700">${formattedDate}</span>
                <span class="text-sm text-gray-500">ржорзЗрж╢рж┐ржиржГ <span class="font-bold text-gray-800">${p.machine}</span></span>
                <span class="px-2 py-1 bg-indigo-100 text-indigo-700 text-xs font-semibold rounded-full">${p.totalRank}</span>
            </div>
            
            <div class="flex justify-center items-end gap-2 text-sm">
                <div>
                    <span class="text-sm text-gray-500">ржУржпрж╝рж╛рж░рзНржХрж╛рж░ржГ <span class="font-bold text-gray-800">${p.workerName}</span></span>
                </div>
                
                <div class="text-right">
                    <span class="text-sm text-gray-500">ржорзЛржЯржГ <span class="font-bold text-gray-800">${p.grandTotal}</span></span>
                </div>
            </div>
        `;
        productionList.appendChild(card);
    });

    // ... (ржХрж╛рж░рзНржбрзЗрж░ ржорж╛ржи ржЖржкржбрзЗржЯ рж▓ржЬрж┐ржХ ржПржХржЗ ржерж╛ржХржмрзЗ) ...
    let totalProduction = groupedArray.reduce((sum, p) => sum + p.grandTotal, 0);
    let totalWorkdays = groupedArray.length;
    let averageProduction = totalWorkdays > 0 ? totalProduction / totalWorkdays : 0;
    
    // ... (рж╕рзНржпрж╛рж▓рж╛рж░рж┐ ржЧржгржирж╛ рж▓ржЬрж┐ржХ ржПржХржЗ ржерж╛ржХржмрзЗ) ...
    const currentMonth = filterMonth.value !== "" ? parseInt(filterMonth.value) : new Date().getMonth();
    const currentYear = filterYear.value !== "" ? parseInt(filterYear.value) : new Date().getFullYear();
    let totalDeterminedSalary = 0; 
    let totalEarnedSalary = 0;
    let totalTarget = 0;

    let workersToCalculate = allWorkers;
    if (workerFilter) {
        const worker = allWorkers.find(w => w.id === workerFilter);
        if (worker) workersToCalculate = [worker];
    }

    workersToCalculate.forEach(worker => {
        const monthlySalary = worker.fixedSalary || 0; 
        const dailyTarget = worker.productionTarget || 0; 
        totalTarget += dailyTarget;
        totalDeterminedSalary += monthlySalary; 

        const workerProductionEntries = groupedArray.filter(p => p.workerId === worker.id);
        if (workerProductionEntries.length > 0) {
            const workerTotalProduction = workerProductionEntries.reduce((sum, p) => sum + p.grandTotal, 0);
            const workerTotalWorkdays = workerProductionEntries.length;
            const workerAverageProduction = workerTotalProduction / workerTotalWorkdays;
            const determinedDailySalary = calculateDailySalary(monthlySalary, currentMonth, currentYear);
            
            const earnedSalary = calculateEarnedSalary(
                workerAverageProduction, dailyTarget, workerTotalWorkdays, determinedDailySalary          
            );
            totalEarnedSalary += earnedSalary; 
        }
    });


    // ржХрж╛рж░рзНржбрзЗ ржорж╛ржи ржкрзНрж░ржжрж░рзНрж╢ржи
    document.getElementById("totalProductionValue").textContent = totalProduction.toFixed(0);
    document.getElementById("averageProductionValue").textContent = averageProduction.toFixed(2);
    document.getElementById("workdayProductionValue").textContent = totalWorkdays;
    document.getElementById("targetProductionValue").textContent = totalTarget.toFixed(0);
    determinedSalaryValue.textContent = totalDeterminedSalary.toFixed(0); 
    earnedSalaryValue.textContent = totalEarnedSalary.toFixed(0);
}


// -----------------------------------------------------------------------
// ЁЯТб ржоржбрж╛рж▓ рж▓ржЬрж┐ржХ (ржХрж╛ржЬрзЗрж░ ржЗржиржкрзБржЯ рж░рзЗржирзНржбрж╛рж░рж┐ржВ-ржП ржлрж┐ржХрзНрж╕ржб ржкрж░рж┐ржмрж░рзНрждржи)
// -----------------------------------------------------------------------

let currentProductionData = null;

window.viewProduction = async function (id) {
    const p = allProductions.find(item => item.id === id) || (await getDoc(doc(db, "productions", id))).data();
    if (!p) return;

    document.getElementById("modalProductionId").value = id;
    document.getElementById("modalTitle").textContent = "ржкрзНрж░рзЛржбрж╛ржХрж╢ржи ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд";
    
    const worker = allWorkers.find(w => w.id === p.workerId);
    const workerName = worker ? worker.name : p.workerName || "ржЕржЬрж╛ржирж╛ ржХрж░рзНржорзА";

    const modalWorkerSelect = document.getElementById("modalWorker");
    modalWorkerSelect.innerHTML = `<option value="${p.workerId}">${workerName}</option>`;
    
    disableEditMode(); 

    currentProductionData = {
        id: id,
        date: p.date,
        workerId: p.workerId,
        machine: p.machine,
        works: p.works || [],
    };
    
    renderWorksContainer(p.works, false);

    document.getElementById("modalDate").value = p.date;
    document.getElementById("modalMachine").value = p.machine;
    document.getElementById("modalGrandTotal").value = p.grandTotal;

    if (currentUserRole === "admin") {
        editDeleteButtons.classList.remove("hidden");
        document.getElementById("editButton").classList.remove("hidden");
        document.getElementById("updateButton").classList.add("hidden");
        document.getElementById("deleteButton").classList.add("hidden");
    } else {
        editDeleteButtons.classList.add("hidden");
    }

    document.getElementById("modal").classList.remove("hidden");
    document.getElementById("modal").classList.add("flex");
}

// ЁЯТб ржлрж┐ржХрзНрж╕ржб ржлрж╛ржВрж╢ржи: ржоржбрж╛рж▓рзЗрж░ ржХрж╛ржЬрзЗрж░ ржЗржиржкрзБржЯ ржкрзНрж░рждрж┐ рж▓рж╛ржЗржирзЗ ржжрзБржЯрж┐ ржХрж░рзЗ ржжрзЗржЦрж╛ржирзЛрж░ ржЬржирзНржп
function renderWorksContainer(works, isEditable) {
    modalWorksContainer.innerHTML = "";
    
    works.forEach((w, index) => {
        const div = document.createElement("div");
        // ЁЯТб ржЫрзЛржЯ рж╕рзНржХрзНрж░рж┐ржирзЗ рзи ржХрж▓рж╛ржо, ржмрзЬ рж╕рзНржХрзНрж░рж┐ржирзЗ рзк ржХрж▓рж╛ржо + ржбрж┐рж▓рж┐ржЯ ржмрж╛ржЯржи
        div.className = "work-entry border-b pb-2"; 
        
        div.innerHTML = `
          
          <div class="col-span-1">
          <label class="block text-gray-500 text-xs sm:hidden">ржмрж┐ржмрж░ржг/ржирж╛ржо</label>
          <input type="text" data-field="product" value="${w.product || ''}" placeholder="ржмрж┐ржмрж░ржг" class="border rounded w-full modal-input" ${isEditable ? '' : 'disabled'}>
          </div>
          
          <div class="sm:col-span-1">
          <label class="block text-gray-500 text-xs sm:hidden">рж╕рзНржЯрж┐ржЪ (Stitch)</label>
          <input type="number" data-field="stage" value="${w.stage || 0}" placeholder="рж╕рзНржЯрж┐ржЪ" class="border rounded w-full modal-input" ${isEditable ? '' : 'disabled'} oninput="calculateModalTotal()">
          </div>
          
          <div class="sm:col-span-1">
          <label class="block text-gray-500 text-xs sm:hidden">ржмрзНржпрж╛рж╕ (Quantity)</label>
          <input type="number" data-field="count" value="${w.count || 0}" placeholder="ржмрзНржпрж╛рж╕" class="border rounded w-full modal-input" ${isEditable ? '' : 'disabled'} oninput="calculateModalTotal()">
          </div>
          
          <div class="sm:col-span-1">
          <label class="block text-gray-500 text-xs sm:hidden">ржорзЛржЯ (Total)</label>
          <input type="text" data-field="total" value="${w.total || 0}" placeholder="ржорзЛржЯ" class="border rounded w-full modal-input bg-gray-50" disabled>
          </div>
            
            <div class="flex justify-center items-center h-full col-span-2 sm:col-span-1">
            ${isEditable ? `
            <button type="button" 
            class="text-red-600 bg-red-100 hover:bg-red-200 border border-red-300 px-3 py-1 rounded-lg text-sm font-semibold flex items-center gap-1 transition duration-150" 
            onclick="removeWorkEntry(this)">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
            ржорзБржЫрзБржи
            </button>` 
            : '<div></div>'}
            </div>
        `;
        modalWorksContainer.appendChild(div);
    });

    if (isEditable) {
    // ржПржХржЯрж┐ ржХржирзНржЯрзЗржЗржирж╛рж░ рждрзИрж░рж┐ ржХрж░рж╛ рж╣рж▓рзЛ ржмрж╛ржЯржиржЯрж┐ржХрзЗ ржорж╛ржЭржЦрж╛ржирзЗ ржЖржирж╛рж░ ржЬржирзНржп
    const buttonContainer = document.createElement("div");
    // flex ржПржмржВ justify-center ржХрзНрж▓рж╛рж╕ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржорж╛ржЭржЦрж╛ржирзЗ ржЖржирж╛ рж╣рж▓рзЛ
    buttonContainer.className = "flex justify-center pt-4"; 
    
    const addButton = document.createElement("button");
    addButton.type = "button";
    addButton.textContent = "+ ржирждрзБржи ржПржирзНржЯрзНрж░рж┐ ржпрзЛржЧ ржХрж░рзБржи";
    
    // ЁЯТб ржЖржкржбрзЗржЯ ржХрж░рж╛ ржХрзНрж▓рж╛рж╕: ржмрж╛ржЯржи рж╕рзНржЯрж╛ржЗрж▓, ржорж╛ржЭржЦрж╛ржирзЗ ржЯрзЗржХрзНрж╕ржЯ, рж╣рзЛржнрж╛рж░ ржЗржлрзЗржХрзНржЯ
    addButton.className = "px-4 py-2 bg-indigo-500 text-white rounded-lg text-sm font-semibold hover:bg-indigo-600 transition duration-150 shadow-md";
    
    addButton.onclick = addWorkEntry;
    
    buttonContainer.appendChild(addButton);
    modalWorksContainer.appendChild(buttonContainer);
    }
    }

// ЁЯТб ржПржбрж┐ржЯ ржорзЛржб рж╕ржХрзНрж╖ржо ржХрж░рж╛ (ржкрзВрж░рзНржмрзЗрж░ ржорждрзЛржЗ)
window.enableEditMode = function() {
    document.getElementById("modalTitle").textContent = "ржкрзНрж░рзЛржбрж╛ржХрж╢ржи ржПржбрж┐ржЯ ржХрж░рзБржи";
    
    document.getElementById("modalDate").disabled = false;
    document.getElementById("modalMachine").disabled = false;
    
    const modalWorkerSelect = document.getElementById("modalWorker");
    modalWorkerSelect.disabled = false;
    modalWorkerSelect.innerHTML = allWorkers.map(w => 
        `<option value="${w.id}" ${currentProductionData.workerId === w.id ? 'selected' : ''}>${w.name}</option>`
    ).join('');

    renderWorksContainer(currentProductionData.works, true);

    document.getElementById("editButton").classList.add("hidden");
    document.getElementById("updateButton").classList.remove("hidden");
    document.getElementById("deleteButton").classList.remove("hidden");
    
    calculateModalTotal();
}

function disableEditMode() {
    document.getElementById("modalDate").disabled = true;
    document.getElementById("modalMachine").disabled = true;
    document.getElementById("modalWorker").disabled = true;
}

// ЁЯТб ржирждрзБржи ржХрж╛ржЬрзЗрж░ ржПржирзНржЯрзНрж░рж┐ ржпрзЛржЧ ржХрж░рж╛ (ржкрзВрж░рзНржмрзЗрж░ ржорждрзЛржЗ)
window.addWorkEntry = function() {
    const newWork = { product: '', stage: 0, count: 0, total: 0 };
    currentProductionData.works.push(newWork);
    renderWorksContainer(currentProductionData.works, true);
    calculateModalTotal();
}

// ЁЯТб ржХрж╛ржЬрзЗрж░ ржПржирзНржЯрзНрж░рж┐ рж░рж┐ржорзБржн ржХрж░рж╛ (ржкрзВрж░рзНржмрзЗрж░ ржорждрзЛржЗ)
window.removeWorkEntry = function(buttonElement) {
    const entryDiv = buttonElement.closest('.work-entry');
    const allEntries = Array.from(modalWorksContainer.querySelectorAll('.work-entry'));
    const index = allEntries.indexOf(entryDiv);
    
    if (index > -1) {
        currentProductionData.works.splice(index, 1);
        renderWorksContainer(currentProductionData.works, true); 
        calculateModalTotal();
    }
}

// ЁЯТб ржорзЛржЯ рж╕рзНржЯрж┐ржЪ ржЧржгржирж╛ ржХрж░рж╛ (ржкрзВрж░рзНржмрзЗрж░ ржорждрзЛржЗ)
window.calculateModalTotal = function() {
    let grandTotal = 0;
    const workEntries = modalWorksContainer.querySelectorAll('.work-entry');
    currentProductionData.works = []; 

    workEntries.forEach((entry) => {
        const productInput = entry.querySelector('[data-field="product"]');
        const stageInput = entry.querySelector('[data-field="stage"]');
        const countInput = entry.querySelector('[data-field="count"]');
        const totalInput = entry.querySelector('[data-field="total"]');

        if (!productInput || !stageInput || !countInput || !totalInput) return; // рж╕рзЗржлржЯрж┐ ржЪрзЗржХ

        const product = productInput.value;
        const stage = parseFloat(stageInput.value) || 0;
        const count = parseFloat(countInput.value) || 0;
        
        const total = stage * count;
        
        totalInput.value = total.toFixed(0);
        grandTotal += total;
        
        currentProductionData.works.push({ product, stage, count, total });
    });
    
    document.getElementById("modalGrandTotal").value = grandTotal.toFixed(0);
}


// -----------------------------------------------------------------------
// ЁЯТб ржЖржкржбрзЗржЯ/ржбрж┐рж▓рж┐ржЯ ржлрж╛ржВрж╢ржи ржПржмржВ ржЗржнрзЗржирзНржЯ рж▓рж┐рж╕рзЗржирж╛рж░рзНрж╕ (ржкрзВрж░рзНржмрзЗрж░ ржорждрзЛржЗ)
// -----------------------------------------------------------------------

productionForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    await updateProduction();
});


async function updateProduction() {
    loader.style.display = "flex";
    const docId = document.getElementById("modalProductionId").value;
    const newDate = document.getElementById("modalDate").value;
    const newWorkerId = document.getElementById("modalWorker").value;
    const newMachine = document.getElementById("modalMachine").value;
    const newGrandTotal = parseFloat(document.getElementById("modalGrandTotal").value);

    calculateModalTotal();
    const newWorks = currentProductionData.works;
    
    if (!docId || newWorks.length === 0) {
        alert("ржЖржкржбрзЗржЯрзЗрж░ ржЬржирзНржп ржкрзНрж░рзЛржбрж╛ржХрж╢ржи ржЖржЗржбрж┐ ржмрж╛ ржХрж╛ржЬрзЗрж░ ржбрзЗржЯрж╛ ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐!");
        loader.style.display = "none";
        return;
    }

    try {
        const productionRef = doc(db, "productions", docId);
        
        await updateDoc(productionRef, {
            date: newDate,
            workerId: newWorkerId,
            machine: newMachine,
            grandTotal: newGrandTotal.toString(),
            works: newWorks,
            lastUpdated: new Date().toISOString(),
        });

        alert("ржкрзНрж░рзЛржбрж╛ржХрж╢ржи рж╕ржлрж▓ржнрж╛ржмрзЗ ржЖржкржбрзЗржЯ рж╣ржпрж╝рзЗржЫрзЗ!");
        closeModal();
        await fetchProductions();
    } catch (error) {
        console.error("ржкрзНрж░рзЛржбрж╛ржХрж╢ржи ржЖржкржбрзЗржЯ ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛:", error);
        alert("ржкрзНрж░рзЛржбрж╛ржХрж╢ржи ржЖржкржбрзЗржЯ ржХрж░рж╛рж░ рж╕ржоржпрж╝ ржПржХржЯрж┐ рждрзНрж░рзБржЯрж┐ рж╣ржпрж╝рзЗржЫрзЗред");
    } finally {
        loader.style.display = "none";
    }
}

async function deleteProduction() {
    if (!confirm("ржЖржкржирж┐ ржХрж┐ ржирж┐рж╢рзНржЪрж┐ржд ржПржЗ ржкрзНрж░рзЛржбрж╛ржХрж╢ржи ржПржирзНржЯрзНрж░рж┐ржЯрж┐ ржбрж┐рж▓рж┐ржЯ ржХрж░рждрзЗ ржЪрж╛ржи? ржПржЗ ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛ржЯрж┐ ржЕржкрж░рж┐ржмрж░рзНрждржирзАржпрж╝ред")) {
        return;
    }

    loader.style.display = "flex";
    const docId = document.getElementById("modalProductionId").value;
    
    try {
        await deleteDoc(doc(db, "productions", docId));
        
        alert("ржкрзНрж░рзЛржбрж╛ржХрж╢ржи рж╕ржлрж▓ржнрж╛ржмрзЗ ржбрж┐рж▓рж┐ржЯ рж╣ржпрж╝рзЗржЫрзЗ!");
        closeModal();
        await fetchProductions();
    } catch (error) {
        console.error("ржкрзНрж░рзЛржбрж╛ржХрж╢ржи ржбрж┐рж▓рж┐ржЯ ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛:", error);
        alert("ржкрзНрж░рзЛржбрж╛ржХрж╢ржи ржбрж┐рж▓рж┐ржЯ ржХрж░рж╛рж░ рж╕ржоржпрж╝ ржПржХржЯрж┐ рждрзНрж░рзБржЯрж┐ рж╣ржпрж╝рзЗржЫрзЗред");
    } finally {
        loader.style.display = "none";
    }
}

window.deleteProduction = deleteProduction;

// ЁЯФ╣ Close Modal (ржкрзВрж░рзНржмрзЗрж░ ржорждрзЛржЗ)
window.closeModal = function () {
    document.getElementById("modal").classList.add("hidden");
    document.getElementById("modal").classList.remove("flex");
    currentProductionData = null; 
}

// ЁЯФ╣ Setup Logout Button (ржкрзВрж░рзНржмрзЗрж░ ржорждрзЛржЗ)
function setupLogoutButton() {
    const logoutBtn = document.getElementById("logoutButton");
    if (logoutBtn) {
        logoutBtn.addEventListener("click", async () => {
            try {
                await signOut(auth);
                window.location.href = "login.html"; 
            } catch (error) {
                console.error("Logout Error:", error);
            }
        });
    }
}

// ЁЯФ╣ Auth State (ржкрзВрж░рзНржмрзЗрж░ ржорждрзЛржЗ)
onAuthStateChanged(auth, async user => {
┬а ┬а if (user) {
┬а ┬а ┬а ┬а if (typeof setupHeaderAndSidebar === "function") setupHeaderAndSidebar();
┬а ┬а ┬а ┬а setupLogoutButton();

┬а ┬а ┬а ┬а const userQuery = query(collection(db, "users"), where("email", "==", user.email));
┬а ┬а ┬а ┬а const userSnapshot = await getDocs(userQuery);
┬а ┬а ┬а ┬а if (!userSnapshot.empty) {
┬а ┬а ┬а ┬а ┬а ┬а const userData = userSnapshot.docs[0].data();
┬а ┬а ┬а ┬а ┬а ┬а currentUserRole = userData.role;
┬а ┬а ┬а ┬а ┬а ┬а if (currentUserRole === "admin") addStitchButton.classList.remove("hidden");
┬а ┬а ┬а ┬а ┬а ┬а else addStitchButton.classList.add("hidden");
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а loadMonthYearFilters();
┬а ┬а ┬а ┬а await loadWorkers();┬а
┬а ┬а ┬а ┬а await fetchProductions();

┬а ┬а ┬а ┬а loader.style.display = "none";
┬а ┬а ┬а ┬а mainContent.classList.remove("hidden");
┬а ┬а ┬а ┬а lucide.createIcons();
┬а ┬а } else {
┬а ┬а ┬а ┬а window.location.href = "login.html";
┬а ┬а }
});

// ЁЯФ╣ Event Listeners (ржкрзВрж░рзНржмрзЗрж░ ржорждрзЛржЗ)
filterFrom.addEventListener("change", renderProductions);
filterTo.addEventListener("change", renderProductions);
filterMachine.addEventListener("change", renderProductions);
filterMonth.addEventListener("change", renderProductions);
filterYear.addEventListener("change", renderProductions);
filterWorker.addEventListener("change", async () => {
┬а ┬а await renderProductions();
});

clearFilter.addEventListener("click", () => {
┬а ┬а const now = new Date();
┬а ┬а filterFrom.value = "";
┬а ┬а filterTo.value = "";
┬а ┬а filterMachine.value = "";
┬а ┬а filterWorker.value = "";
┬а ┬а filterMonth.value = now.getMonth();
┬а ┬а filterYear.value = now.getFullYear();
┬а ┬а renderProductions();
});
</script>
</body>
</html>